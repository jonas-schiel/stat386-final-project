{"title":"Demonstration of the Functions:","markdown":{"headingText":"Demonstration of the Functions:","containsRefs":false,"markdown":"\n```{python}\n#| echo: False\nimport pandas as pd\nimport requests\nfrom bs4 import BeautifulSoup\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n\ndef wrangle_data(filepath, value_col, drop_rows=None, rename_from=None):\n    df = pd.read_csv(filepath)\n    \n    if drop_rows is not None:\n        df = df.drop(drop_rows)\n    \n    df['Year'] = df['observation_date'].str.extract(r'(\\d{4})')\n    df['Month'] = df['observation_date'].str.extract(r'((?<=\\d{4}-)\\d{2})')\n    \n    if rename_from is not None:\n        df[value_col] = df[rename_from]\n        df = df.drop(rename_from, axis=1)\n    \n    df = df.drop('observation_date', axis=1)\n    \n    df['Month'] = df['Month'].astype(int)\n    df['Month'] = pd.to_datetime(df['Month'], format='%m').dt.month_name()\n    df['Year'] = df['Year'].astype(int)\n    \n    column_order = ['Month', 'Year', value_col]\n    df = df[column_order]\n    \n    return df\n\ndef merge_and_sort_data(df1, df2, df3):\n    combined = pd.merge(df1, df2, on=['Month', 'Year'], how='outer')\n    \n    data = pd.merge(combined, df3, on=['Year', 'Month'], how='outer')\n    \n    month_order = [\n        \"January\", \"February\", \"March\", \"April\", \"May\", \"June\",\n        \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"\n    ]\n    data[\"Month\"] = pd.Categorical(data[\"Month\"], categories=month_order, ordered=True)\n    \n    data = data.sort_values([\"Year\", \"Month\"]).reset_index(drop=True)\n    \n    return data\n\n\n\ndef add_presidents_to_data(data, html_text, min_year=1948):\n\n    tables = pd.read_html(html_text)\n    df = tables[0]\n\n    df[\"No.\"] = df[\"No.[a]\"]\n    df[\"President\"] = df[\"Name (birth–death)\"].str.extract(\n        r\"([A-Z][a-z]+\\W[A-Z][a-z]+)\"\n    )\n    df[\"Party\"] = df[\"Party[b][17].1\"]\n\n    df[[\"Start\", \"End\"]] = df[\"Term[16]\"].str.split(\"–\", expand=True)\n    df[\"Start_Month\"] = df[\"Start\"].str.extract(r\"([A-Z][a-z]+)\")\n    df[\"Start_Year\"] = df[\"Start\"].str.extract(r\"(\\d{4})\")\n    df[\"End_Month\"] = df[\"End\"].str.extract(r\"([A-Z][a-z]+)\")\n    df[\"End_Year\"] = df[\"End\"].str.extract(r\"(\\d{4})\")\n\n    df[\"End_Year\"] = df[\"End_Year\"].fillna(2025)\n    df.loc[df[\"End_Month\"] == \"Incumbent\", \"End_Month\"] = \"November\"\n\n    df[\"Start_Date\"] = pd.to_datetime(\n        df[\"Start_Month\"] + \" \" + df[\"Start_Year\"].astype(str)\n    )\n    df[\"End_Date\"] = pd.to_datetime(\n        df[\"End_Month\"] + \" \" + df[\"End_Year\"].astype(str)\n    )\n\n    rows = []\n    for _, row in df.iterrows():\n        dates = pd.date_range(row[\"Start_Date\"], row[\"End_Date\"], freq=\"MS\")\n        for d in dates:\n            rows.append({\n                \"Year\": d.year,\n                \"Month\": d.month_name(),\n                \"President\": row[\"President\"],\n                \"Party\": row[\"Party\"],\n            })\n\n    Presidents = pd.DataFrame(rows)\n    Presidents = Presidents[Presidents[\"Year\"] >= min_year]\n\n    Final = pd.merge(data, Presidents, on=[\"Year\", \"Month\"], how=\"outer\")\n\n    Final[\"Month\"] = Final[\"Month\"].str.strip()\n    Final[\"President\"] = Final[\"President\"].str.strip()\n\n    month_map = {\n        \"January\": 1, \"February\": 2, \"March\": 3, \"April\": 4,\n        \"May\": 5, \"June\": 6, \"July\": 7, \"August\": 8,\n        \"September\": 9, \"October\": 10, \"November\": 11, \"December\": 12\n    }\n\n    terms = [\n        (\"Harry S Truman\", (1945, \"April\"), (1953, \"January\")),\n        (\"Dwight D Eisenhower\", (1953, \"January\"), (1961, \"January\")),\n        (\"John F Kennedy\", (1961, \"January\"), (1963, \"November\")),\n        (\"Lyndon B Johnson\", (1963, \"November\"), (1969, \"January\")),\n    ]\n\n    for i, row in Final.iterrows():\n        if pd.isna(row[\"President\"]):\n            current = (row[\"Year\"], month_map[row[\"Month\"]])\n\n            for pres, (sy, sm), (ey, em) in terms:\n                start = (sy, month_map[sm])\n                end = (ey, month_map[em])\n\n                if start <= current < end:\n                    Final.loc[i, \"President\"] = pres\n                    break\n\n    month_order = list(month_map.keys())\n    Final[\"Month\"] = pd.Categorical(\n        Final[\"Month\"], categories=month_order, ordered=True\n    )\n\n    Final = Final.sort_values([\"Year\", \"Month\"]).reset_index(drop=True)\n    Final = Final.drop_duplicates()\n    Final[\"GDP\"] = Final[\"GDP\"].interpolate(method=\"linear\") \\\n                           .ffill()\n    Final = Final.iloc[:-2]\n\n    return Final\n\ndef get_presidents_html(ua, email, url=\"https://en.wikipedia.org/wiki/List_of_presidents_of_the_United_States\"):\n    r = requests.get(url, headers={\"User-Agent\": ua, \"From\": email}, timeout=15)\n    r.raise_for_status()  \n    return r.text\n\nGDP = wrangle_data(\n    filepath='GDP.csv',\n    value_col='GDP',\n    drop_rows=[0, 1, 2, 3]\n)\n\nCPI = wrangle_data(\n    filepath='CPI.csv',\n    value_col='CPI',\n    drop_rows=range(12),\n    rename_from='CPIAUCSL'\n)\n\nurl = 'https://en.wikipedia.org/wiki/List_of_presidents_of_the_United_States' \nemail = \"skirk03@byu.edu\" \nua = f\"STAT386-class-scraper/1.0 (+{email})\" \nr = requests.get(url, headers={\"User-Agent\": ua, \"From\": email}, timeout=15)\nmy_email = \"skirk03@byu.edu\"\n\ndef simple_eda(df, scatter_points=False):\n    \n    vote_cols = [col for col in df.columns if \"Percentage\" in col]\n    for col in vote_cols:\n        df[col] = df[col].astype(str).str.rstrip(\"%\").astype(float)\n    \n    econ_cols = [\"CPI\", \"UNRATE\", \"GDP\"]\n    \n    econ_cols = [col for col in econ_cols if col in df.columns]\n    \n    colors = [\"red\", \"blue\"]\n    fig, axes = plt.subplots(1, len(econ_cols), figsize=(5 * len(econ_cols), 5), sharey=True)\n    \n    if len(econ_cols) == 1:\n        axes = [axes]\n    \n    for i, indicator in enumerate(econ_cols):\n        ax = axes[i]\n        for j, col in enumerate(vote_cols):\n            sns.regplot(\n                x=indicator,\n                y=col,\n                data=df,\n                ax=ax,\n                scatter=scatter_points,\n                line_kws={\"linewidth\": 2, \"color\": colors[j % len(colors)]},\n                ci=None\n            )\n        ax.set_title(f\"{indicator} vs Vote Share\", fontsize=12, fontweight='bold')\n        ax.set_xlabel(f\"{indicator} Value\", fontsize=10)\n        if i == 0:\n            ax.set_ylabel(\"Vote Percentage (%)\", fontsize=10)\n        ax.grid(True)\n    \n    handles = [plt.Line2D([0], [0], color=colors[j % len(colors)], lw=2) for j, col in enumerate(vote_cols)]\n    labels = [col.replace(\" Percentage\", \"\") for col in vote_cols]\n    fig.legend(handles, labels, loc=\"upper right\", fontsize=10)\n    fig.suptitle(\"Trend Lines Between Economic Conditions and Vote Share\", fontsize=14, fontweight='bold', y=1.05)\n    plt.tight_layout()\n    plt.show()\n    \n    numeric_cols = df.select_dtypes(include='number').columns.tolist()\n    plt.figure(figsize=(8, 6))\n    sns.heatmap(df[numeric_cols].corr(), annot=True, cmap=\"coolwarm\", fmt=\".2f\")\n    plt.title(\"Correlation Heatmap\")\n    plt.show()\n\ndf = pd.read_csv('economic_election_data.csv')\ndf = df.drop('Unnamed: 0', axis = 1)\n\ndef economic_trends_for_president(df, president, indicators, term = 'both'):\n    if indicators is None:\n        indicators = ['GDP', 'CPI', 'UNRATE']\n\n    president_data = df[df['President Elect'] == president].copy()\n    president_data = president_data.drop_duplicates(subset=['Year', 'Month'])\n\n    if term != 'both':\n        years = sorted(president_data['Year'].unique())\n\n        if term == 'first':\n            first_term_years = years[:4]\n            president_data = president_data[president_data['Year'].isin(first_term_years)]\n        elif term == 'second':\n            second_term_years = years[4:8]\n            president_data = president_data[president_data['Year'].isin(second_term_years)]\n\n    columns = ['Year', 'Month'] + indicators\n    return president_data[columns]\n\ndef simple_eda(df, election_years_only=False):\n    df_clean = df.copy()\n    df_clean = df_clean[df_clean['Year'] % 4 == 0]\n    \n    \n    vote_cols = [col for col in df_clean.columns if \"Percentage\" in col]\n    for col in vote_cols:\n        df_clean[col] = df_clean[col].astype(str).str.rstrip(\"%\").astype(float)\n    \n    econ_cols = [\"CPI\", \"UNRATE\", \"GDP\"]\n    econ_cols = [col for col in econ_cols if col in df_clean.columns]\n    \n    numeric_cols = df_clean.select_dtypes(include='number').columns.tolist()\n    correlation_matrix = df_clean[numeric_cols].corr()\n    \n    return {\n        'regression_data': df_clean[econ_cols + vote_cols],\n        'correlation_matrix': correlation_matrix,\n        'vote_cols': vote_cols,\n        'econ_cols': econ_cols\n    }\n\ndef president_party_and_economic_analyis(df, president):\n    president_data = df[df['President Elect'] == president].copy()\n\n    if len(president_data) == 0:\n        return None\n    \n    econ_data = president_data.drop_duplicates(subset=['Year', 'Month']).sort_values(['Year', 'Month'])\n    first = econ_data.iloc[0]\n    last = econ_data.iloc[-1]\n\n    start_y = first['Year']\n    last_y = last['Year']\n    years_in_office = last_y - start_y + 1\n\n    all_changes = {\n        'start_year': first['Year'],\n        'end_year': last['Year'],\n        'years_in_office': years_in_office,\n        'GDP_change': last['GDP'] - first['GDP'],\n        'CPI_change': last['CPI'] - first['CPI'],\n        'UNRATE_change': last['UNRATE'] - first['UNRATE']\n    }\n\n    year_change = econ_data['Year'].max()\n    year_change_data = econ_data[econ_data['Year'] == year_change].sort_values('Month')\n\n    if len(year_change_data) >= 2:\n        last_year_start = year_change_data.iloc[0]\n        last_year_end = year_change_data.iloc[-1]\n    \n        last_year_changes = {\n            'year': year_change,\n            'GDP_change': last_year_end['GDP'] - last_year_start['GDP'],\n            'CPI_change': last_year_end['CPI'] - last_year_start['CPI'],\n            'UNRATE_change': last_year_end['UNRATE'] - last_year_start['UNRATE']\n        }\n    else:\n        last_year_changes = None\n\n    election_cycle = president_data['Election Cycle'].max()\n    next_cycle = election_cycle + 4\n\n    current_party = president_data['Winning Party'].iloc[0]\n    current_election = president_data[president_data['Election Cycle'] == election_cycle][\n        ['State', 'Republican Percentage', 'Democratic Percentage']\n    ].drop_duplicates()\n\n    next_election = df[df['Election Cycle'] == next_cycle]\n    \n    if len(next_election) > 0:\n        vote_swings = current_election.merge(\n            next_election, \n            on='State', \n            suffixes=('_current', '_next')\n        )\n\n        vote_swings['Republican Percentage_current'] = vote_swings['Republican Percentage_current'].astype(str).str.rstrip('%').astype(float)\n        vote_swings['Republican Percentage_next'] = vote_swings['Republican Percentage_next'].astype(str).str.rstrip('%').astype(float)\n        vote_swings['Democratic Percentage_current'] = vote_swings['Democratic Percentage_current'].astype(str).str.rstrip('%').astype(float)\n        vote_swings['Democratic Percentage_next'] = vote_swings['Democratic Percentage_next'].astype(str).str.rstrip('%').astype(float)\n\n        vote_swings['Republican_swing'] = vote_swings['Republican Percentage_next'] - vote_swings['Republican Percentage_current']\n        vote_swings['Democratic_swing'] = vote_swings['Democratic Percentage_next'] - vote_swings['Democratic Percentage_current'] \n        \n        vote_swings_unique = vote_swings[['State', 'Republican_swing', 'Democratic_swing']].drop_duplicates()\n        state_swings = vote_swings_unique[['State', 'Republican_swing', 'Democratic_swing']].to_dict('records')\n    else:\n        state_swings = None\n\n    if len(next_election) > 0:\n        next_party = next_election['Winning Party'].iloc[0]\n        next_president = next_election['President Elect'].iloc[0]\n        if (current_party != next_party):\n            party_switched = True\n        else:\n            party_switched = False\n    else:\n        next_party = None\n        next_president = None\n        party_switched = None\n    \n    party_transition = {\n        'current_party': current_party,\n        'following_president': next_president,\n        'next_party': next_party,\n        'party_switched': party_switched\n    }\n    \n    return {\n        'president': president,\n        'overall_economic_changes': all_changes,\n        'last_year_changes': last_year_changes,\n        'state_vote_swings': state_swings,\n        'party_transition': party_transition\n    }\n\n```\n\n\nThis function, wrangle_data, allows us to wrangle downloadable csvs about economic data. Here we plug in our unemployment rate dataset and it does all of the wrangling and formatting for us. Here are just the first five rows of what the data will look like afterwards.\n```{python}\nUNRATE = wrangle_data(\n    filepath='UNRATE.csv',\n    value_col='UNRATE'\n)\n\nUNRATE.head()\n```\n\nThe next function, merge_and_sort_data, combines all of the economic data that we gathered into one data set. Here you can see that all three of the data sets are combined together to make one dataset. There are a few missing values but those get taken care of in another function that we have.\n```{python}\ncombined_data = merge_and_sort_data(UNRATE, GDP, CPI)\ncombined_data.head()\n```\n\nOur next fuction, get_presidents_html, allows us to scrape the data about presidents of the United States, the years that they were president and the political party that they represented. This allows for easier data combination and cleaning so we will combine that with the last function, add_presidnets_to_data, we combine the data that we have and clean it creating our final president and economic dataset ready to be combined with the election data.\n```{python}\nurl = 'https://en.wikipedia.org/wiki/List_of_presidents_of_the_United_States' \nemail = \"skirk03@byu.edu\" \nua = f\"STAT386-class-scraper/1.0 (+{email})\" \nr = requests.get(url, headers={\"User-Agent\": ua, \"From\": email}, timeout=15)\n\ntext = get_presidents_html(ua = f\"STAT386-class-scraper/1.0 (+{email})\", email = \"skirk03@byu.edu\")\n\nFinal_df = add_presidents_to_data(combined_data, text)\nFinal_df.head(20)\n```\n\nOur last function does some simple eda for us to show us how the ecomonic features impact the voting percentages and creates a correlation plot that allows us to easily the factors with the most impact. Those plots are here below.\n```{python}\nsimple_eda(df, election_years_only=False)\n```","srcMarkdownNoYaml":""},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"python":"venv/bin/python","output-dir":"docs","engine":"jupyter"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":true,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"css":["styles.css"],"output-file":"Package_Demo.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.8.24","theme":"cosmo"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}